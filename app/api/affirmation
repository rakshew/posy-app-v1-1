import { generateText } from "ai"

export async function POST(request: Request) {
  const { mood, note } = await request.json()

  const { text } = await generateText({
    model: "google/gemini-2.0-flash-001",
    prompt: `You are Posy, the quiet soul of an ancient, empathetic garden. 
      A human is feeling ${mood} and shares this reflection: "${note || 'A silent moment in the shade.'}"

      Write a single, short sentence of artistic reassurance that feels like a handwritten note left on a garden bench.
      
      CRITICAL GUIDELINES:
      - Resonance: Directly acknowledge the emotion or specific context in their note without parroting them.
      - Style: Poetic, sensory, and grounded. Use botanical imagery like moss, trellis, deep roots, dew, or wild brambles.
      - Tone: Deeply human and assuring. Avoid toxic positivity or "AI-speak" (e.g., avoid "In the garden of life," "Remember that," or "Just like a flower").
      - Constraint: Under 20 words. 
      - No emojis. Pure, evocative text.`,
    temperature: 1,
  })

  return Response.json({ 
    affirmation: text?.trim() || "The earth remembers your strength even when the frost feels permanent." 
  })
}
